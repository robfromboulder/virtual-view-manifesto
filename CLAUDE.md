# Claude Code Instructions for "The Virtual View Manifesto"

**Project**: The Virtual View Manifesto
**Author**: Rob Dickinson (robfromboulder)
**Primary File**: `README.md` (generated from section files)
**Output Format**: Markdown with Mermaid diagrams for GitHub rendering
**Related Tools**: ViewMapper and ViewZoo (Apache 2 licensed projects by Rob)

---

## üéØ Project Overview

This is a technical manifesto about virtual view hierarchies in SQL databases, with Trino as the reference implementation. The document is published as part of Rob's GitHub portfolio and is intended to establish a repeatable architectural pattern for the data engineering community.

---

## üìù Current Status

**Version**: 0.60 (Draft)
**Last Updated**: 2025-12-21
**Status**: Work in progress, refactored into modular section files
**Next Milestone**: 1.0 release after incorporating feedback
**Entire document is open for review**

---

## üë• Target Audience

- **Primary**: Trino users (full-stack engineers, application architects, big-data practitioners)
- **Secondary**: Everyone else interested in SQL view patterns
- **Assumptions**: Familiar with SQL views but may not have thought about them architecturally
- **Needs**: Practical guidance, not academic theory
- **Appreciation**: Technical detail and concrete examples
- **Focus**: Keep content optimized for Trino users first

---

## üìã Success Criteria

The manifesto is successful if readers:

1. ‚úÖ Understand virtual views as architectural pattern, not just database or Trino-specific feature
2. ‚úÖ Can implement basic prototyping ‚Üí testing ‚Üí production progression
3. ‚úÖ Know when to use (and not use) the pattern
4. ‚úÖ Understand the eight principles and why they matter
5. ‚úÖ Have links to ViewMapper and ViewZoo for implementation

---

## ü§ñ Collaboration Preferences

**Priority order for all work**:
1. **Accuracy and terminology consistency** (paramount)
2. **Conciseness and logical flow** (next priority)
3. **Creativity** (only when specifically requested)

**Always validate Mermaid diagrams** when making changes to ensure they render correctly.

---

## üìê Document Structure

The README is generated from section files in `sections/`. When editing:

**IMPORTANT**: Edit files in `sections/`, NOT `README.md` directly. The README is generated by `./build.sh`.

Section-to-content mapping:
1. **Header** (`00-header.md`): Title, TOC, what's novel, what's controversial
2. **Introduction** (`01-introduction.md`): Problem statement, classical vs virtual views
3. **Principles** (`02-principles.md`): Core architectural principles with examples
4. **Use Cases** (`03-use-cases.md`): Eight practical scenarios (note: Use Case 8 is stub for future completion)
5. **Implementation Guide** (`04-implementation.md`): Setup, complete e-commerce example, documentation/tooling
6. **Common Pitfalls** (`05-pitfalls.md`): Seven mistakes and solutions
7. **When NOT to Use** (`06-anti-patterns.md`): Three anti-patterns
8. **Related Tools** (`07-tools.md`): ViewMapper and ViewZoo documentation
9. **Glossary** (`08-glossary.md`): Technical term definitions
10. **Footer** (`09-footer.md`): License, thanks, metadata

### Build Workflow

```bash
# Edit a section file
vi sections/02-principles.md

# Rebuild README
./build.sh

# Verify the changes
git diff README.md

# Commit both the section and generated README
git add sections/02-principles.md README.md
git commit -m "Update Principle 5 with new example"
```

### Section File Formatting Convention

**IMPORTANT**: All section files (except `00-header.md`) follow a consistent format:

**File start:**
```
---
<blank line>
## Section Title
...content...
```

**File end:**
```
...content...
<blank line>
```

This convention ensures clean separation when files are concatenated and makes the structure easier to maintain. The `00-header.md` file is the exception since it contains the document preamble and doesn't need the leading delimiter.

### Information Flow Best Practices

- Place context/setup paragraphs BEFORE examples (not after)
- Position diagrams early to visualize concepts immediately
- Remove redundant subsections when content is already covered elsewhere
- Ensure diagram elements match surrounding text (e.g., if diagram shows demo/test data, mention it)
- Make example headers consistent ("Example of..." pattern)
- Use GitHub callout boxes (> [!CAUTION], > [!TIP]) for important warnings and tips

### Important Notes

- `.claudeignore` excludes README.md to prevent loading the full file
- Section files are the source of truth for editing
- README.md is committed to git for GitHub display convenience

---

## ‚úçÔ∏è Writing & Style Guide

### Voice & Tone

- **Strongly opinionated but not fundamentalist**
- **Plain language and simple sentence construction**
- Use Rob's natural speaking voice (casual, practical, not overly formal)
- "Manifesto" is tongue-in-cheek to attract attention to typically boring database topic
- **Avoid "I" and "we" language**; use third-person objective
- Think **Douglas Adams meets database architecture**
- **Clean and precise as a manifesto** - humor is welcome but shouldn't distract or add complexity
- **Humor and emojis**: Use sparingly, only when payoff is obvious

### Editorial Standards

- Be honest about limitations
- Openly recognize constraints and other potential points of view
- Pragmatic over dogmatic
- When in doubt: simpler is better
- **Never use em dashes (‚Äî)**: They cause formatting issues with web content and signal AI-generated text to readers. Use commas instead, extending sentences naturally without colons or dashes as breaks

### Preferred Terminology

| Use | Instead of | Reason |
|-----|-----------|--------|
| Virtual views | Logical views | Emphasizes detachment from physical |
| Layer | Level | Implies responsibility, not just hierarchy |
| Swappable | Replaceable | Implies designed for it |
| Application catalog | Feature catalog | Either works, depends on context |
| Federation | Data virtualization | More concrete |

### Content Standards

**Scope and Emphasis**:
1. **Scope**: Concepts apply to any database, but Trino is reference implementation due to federation capabilities
2. **Audience assumptions**: Brief primer on classical views included for contrast
3. **Dogmatism level**: Strongly opinionated but pragmatic
4. **Example complexity**: Both simple and realistic for each major point

**Use Case Selection Criteria**:
- **Focus on the virtual view pattern**, not just Trino capabilities
- Ask: "Does this demonstrate something you *couldn't easily do* without virtual views?"
- **Avoid use cases that are just Trino features** (e.g., "Cross-Database Federation" showcases Trino's federation but doesn't highlight the swappability/versioning that makes virtual views unique)
- Good use cases demonstrate: swappable implementations, independent layer evolution, static-to-live progressions, runtime reconfiguration
- Each use case should show a problem that virtual views solve better than alternatives

**Example Structure Pattern**:
1. **Simple example** (3-10 lines of SQL)
2. **Realistic example** (20-50 lines showing production complexity)
3. **Explanation** (why it matters, when to use it)
4. **Visual** (Mermaid diagram when helpful)

---

## üé® Formatting Guidelines

### GitHub Rendering
- Standard GitHub-flavored Markdown
- Mermaid diagrams for visualizations
- Code samples throughout (always use proper language tags)
- No need to mention installation/configuration details (covered by linked projects)

### Code Blocks
- Always specify language: ```sql, ```python, ```bash, etc.
- Keep examples realistic but concise
- Include both simple and realistic examples for major points
- Use comments sparingly (code should be self-evident)

### Mermaid Diagrams
- **Test rendering in GitHub preview** - Always validate before committing
- Use flowcharts for architecture and dependencies (`flowchart TD` by default)
- Use Gantt charts for timeline progressions
- **Use black-and-white only** - No custom colors or fills for readability in both light and dark modes
- **Use quotes for labels even when not strictly required** - use `Tables[("Physical Tables")]`, not `Tables[(Physical Tables)]`

### Example Naming Conventions

**CRITICAL**: All SQL examples must follow the three-level naming convention consistently throughout the document.

**Physical tables** (connector.schema.table):
- ‚úÖ `postgresql.myapp.users`, `postgresql.myapp.orders`, `iceberg.myapp.events`
- ‚ùå `postgresql.users` (missing schema), `postgresql.app.users` (wrong schema name)

**Virtual views** (catalog.schema.view):
- ‚úÖ `myapp.users.all`, `myapp.orders.pending`, `myapp.events.base`
- ‚ùå `myapp.users` (missing view name), `myapp.all_users` (use feature schema)

**Schema ‚Üí Catalog transformation pattern**:
- **Before (physical)**: `postgresql.myapp.users` - `myapp` is a schema in PostgreSQL
- **After (virtual)**: `myapp.users.all` - `myapp` is promoted to a catalog, `users` is a feature schema

**Common naming patterns**:
- `.all` - Common entry point (e.g., `myapp.users.all`)
- `.base` - Base layer in hierarchy
- `.merged` - Merge layer combining sources
- `.filtered` - Privacy/filtering layer
- `.enriched` - Transformation layer
- Use `myapp.internal.*` for multi-layer hierarchies when demonstrating layer separation

**Why this matters**: Teaches the transformation pattern, makes abstraction crystal clear, shows readers exactly how to structure their own implementations. Every example reinforces the same mental model.

---

## üîÑ Revision Workflow

### When Making Content Changes

1. **Check prose consistency and flow**
2. **Ensure examples are clear and compelling**
3. **Verify Mermaid diagrams render correctly** (use GitHub preview)
4. **Check that all cross-references work** (anchors, links, section references)
5. **Verify tone consistency** (technical but accessible, opinionated but pragmatic)
6. **Update version metadata** in footer section (09-footer.md):
   - Bump version number (e.g., 0.1 ‚Üí 0.2 for minor, 1.0 for major)
   - Update "Last Updated" date

### When Making Major Changes

When making substantial revisions to the manifesto structure, voice, or strategy, update this CLAUDE.md file accordingly (terminology table, success criteria, document structure).

---

## üîó Related Projects

Always include these links where relevant:

- **ViewMapper**: [github.com/robfromboulder/viewmapper](https://github.com/robfromboulder/viewmapper)
  (Agentic schema mapper for Trino views)

- **ViewZoo**: [github.com/robfromboulder/viewzoo](https://github.com/robfromboulder/viewzoo)
  (Lightweight storage for Trino views)

Both are Apache 2 licensed, created by Rob.

---

**Last Updated**: 2025-12-21
**Maintained By**: Claude Code (for Rob's review and approval)